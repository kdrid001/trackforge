{% extends 'base.html' %}
{% block content %}
  <h2 class="text-xl font-medium mb-4">Today ({{ today.isoformat() }})</h2>

  <!-- Add Task -->
  <form action="{{ url_for('add_task') }}" method="post" class="bg-white rounded-2xl border border-slate-200 p-4 mb-6">
    <div class="grid md:grid-cols-2 gap-3">
      <input name="title" placeholder="Title" class="px-3 py-2 rounded-lg border border-slate-300" required>
      <input name="source" placeholder="Source (e.g., Grokking ch4 or URL)" class="px-3 py-2 rounded-lg border border-slate-300">
      <input name="tags" placeholder="Tags (e.g., DSA;Python)" class="px-3 py-2 rounded-lg border border-slate-300">
      <div class="flex items-center gap-3">
        <label class="text-sm">Pomos</label>
        <input type="number" name="pomos" min="1" max="8" value="1" class="w-24 px-3 py-2 rounded-lg border border-slate-300">
        <label class="text-sm">Due</label>
        <input type="date" name="due" value="{{ today.isoformat() }}" class="px-3 py-2 rounded-lg border border-slate-300">
      </div>
    </div>
    <div class="mt-3 flex justify-end">
      <button class="px-3 py-1.5 rounded-lg bg-slate-900 text-white">Save Task</button>
    </div>
  </form>

  {% if items|length == 0 %}
    <p class="text-slate-600">No tasks due today yet. Add one above.</p>
  {% else %}
    <ul class="grid md:grid-cols-2 gap-4">
      {% for t in items %}
        <li class="bg-white rounded-2xl border border-slate-200 p-4">
          <div class="flex items-start justify-between gap-4">
            <div>
              <h3 class="font-semibold">{{ t.title }}</h3>
              {% if t.source %}
                <p class="text-sm text-slate-600">Source: {{ t.source }}</p>
              {% endif %}
              <div class="mt-2 flex flex-wrap gap-1">
                {% for tag in t.tag_list() %}
                  <span class="text-xs px-2 py-0.5 rounded-full bg-slate-100 border border-slate-200">{{ tag }}</span>
                {% endfor %}
              </div>
              <p class="mt-2 text-sm text-slate-700">
                Planned: {{ t.estimate_pomos }} Â· Logged: {{ t.actual_pomos }}
              </p>
            </div>
            <div class="flex flex-col gap-2 shrink-0">
              <form action="{{ url_for('mark_done', task_id=t.id) }}" method="post">
                <button class="px-3 py-1.5 rounded-lg text-sm bg-emerald-600 text-white">Mark Done</button>
              </form>
              <form action="{{ url_for('delete_task', task_id=t.id) }}" method="post">
                <button class="px-3 py-1.5 rounded-lg text-sm bg-white border border-slate-300">Delete</button>
              </form>
            </div>
          </div>
        </li>
      {% endfor %}
    </ul>
  {% endif %}
{% endblock %}
